@startuml TCL Formatter Component Diagram

!define LIGHTYELLOW #FFFACD
!define LIGHTBLUE #ADD8E6
!define LIGHTGREEN #90EE90

title TCL Formatter & Syntax Debugger - Component Diagram

skinparam component {
    BackgroundColor LIGHTBLUE
    BorderColor Black
}

skinparam interface {
    BackgroundColor LIGHTGREEN
    BorderColor Black
}

package "TCL Formatter Application" {
    
    [main.py] as Main LIGHTYELLOW
    
    package "UI Components (PyQt6)" {
        [TCLFormatterUI] as UI
        [FormatterWorker] as Worker
        
        interface "QMainWindow" as IMainWindow
        interface "QThread" as IThread
        
        UI -up- IMainWindow
        Worker -up- IThread
    }
    
    package "Core Formatting Engine" {
        [TCLFormatter] as Formatter
        
        interface "IFormatter" as IFormatter
        Formatter -up- IFormatter
    }
    
    package "Validation Engine" {
        [SyntaxValidator] as Validator
        
        interface "IValidator" as IValidator
        Validator -up- IValidator
    }
    
    package "Formatting Engines" {
        [IndentationEngine] as Indent
        [ListExpansionEngine] as ListExp
        [AlignmentEngine] as Align
        
        interface "IIndentation" as IIndent
        interface "IListExpansion" as IListExp
        interface "IAlignment" as IAlign
        
        Indent -up- IIndent
        ListExp -up- IListExp
        Align -up- IAlign
    }
    
    package "Data Models" {
        [SyntaxError] as SyntaxErr
        [StackFrame] as Stack
        [FormattingResult] as Result
    }
    
    ' Dependencies
    Main --> UI : creates
    UI --> Worker : creates
    Worker --> Formatter : uses
    
    Formatter --> Validator : validates with
    Formatter --> Indent : formats with
    Formatter --> ListExp : expands with
    Formatter --> Align : aligns with
    
    Formatter ..> Result : produces
    Validator ..> SyntaxErr : produces
    Validator ..> Stack : uses
    
}

' External dependencies
cloud "PyQt6 Framework" {
    [QApplication]
    [QWidgets]
    [QThread API]
}

cloud "Python Standard Library" {
    [os]
    [pathlib]
    [typing]
}

cloud "Third-Party Libraries" {
    [chardet] as Chardet
}

' External connections
UI --> QApplication : extends
UI --> QWidgets : uses
Worker --> [QThread API] : extends

Formatter --> os : file operations
Formatter --> pathlib : path handling
Formatter --> Chardet : encoding detection

note right of Main
  Entry point:
  - Creates QApplication
  - Initializes TCLFormatterUI
  - Starts event loop
end note

note right of Formatter
  Orchestrator:
  - Reads TCL files
  - Coordinates engines
  - Writes output/errors
end note

note bottom of Validator
  Stack-based validation:
  - Brace matching
  - Quote matching
  - Error reporting
end note

note bottom of Indent
  Indentation rules:
  - 2 spaces per level
  - Block keyword detection
  - Brace nesting tracking
end note

note bottom of ListExp
  List expansion:
  - Detects lists > 80 chars
  - Multiline formatting
  - Preserves nesting
end note

note bottom of Align
  Set command alignment:
  - Finds consecutive blocks
  - Aligns assignment values
  - Column calculation
end note

@enduml
